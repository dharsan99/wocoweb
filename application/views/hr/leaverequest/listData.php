<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/css/select2.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.min.js"></script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1><small>Leave Request Management/</small></h1>
      <div class="row">
        <div class="col-xs-6">
            <h3>Leave Request Management</h3>
        </div>
      </div>
    </section>
    <section class="content">
      <div class="row">
        <div class="col-xs-12">
          <div class="box custom-box">
            <div class="row">
              <div class="col-md-7">
                <div class="col-md-2">
                   <div class="row">
                     <div class="profile-img">
                           <img alt="User Image" src="http://woco.co.in/uploads/user/1554275199.png" class=" profile-logo-img img-responsive " style=" width: 82px !important;">
                       </div>
                   </div>
                </div>
                <div class="col-md-9">
                  <div class="twPc-divUser" style=" margin-left: 0px !important;">
                     <div class="twPc-divName profile-info">
                       <h2>Hr Manager</h2>
                       <div class="details">
                         <div class="i-btn">
                            <li class="twPc-ArrangeSizeFit">
                              <span><i class="fa fa-briefcase emp-icon"></i><a href="#">HR Manager  </a></span>
                             </li>
                          </div>
                       </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-md-5">
                <div class="box-footer" style="/* text-align:center; */float: right;/* margin-top: -35px; */">
                    <input type="submit" class="btn btn-primary" value="Approve" style="width:134px !important; height: 38px !important;" data-toggle="modal" data-target="#myModal">
                      <input type="reset" class="btn btn-default rqst-btn-rst" onclick="resetform()" value="Reject" style="width:134px !important;">
                  </div>
              </div>

            </div>
            <hr style=" margin-top: 6px !important; border-top: 2px solid #eceff5;">
            <table class="rqst-tble rqst-tble1" style="margin-top: -6px;">
              <thead>
                  <tr>
                    <th scope="col">Leave Dates</th>
                    <th scope="col">Leave Type</th>
                    <th scope="col">Applied on</th>
                    <th scope="col">Category</th>
                    <th scope="col">Leave Status</th>
                  </tr>
              </thead>
              <tbody>
                <tr>
                  <td data-label="Type">7 May- 11 May 2019</td>
                  <td data-label="Category">Full Day</td>
                  <td data-label="Category">29 Apr 2019</td>
                  <td data-label="Category">EL</td>
                  <td data-label="Category">Pending</td>
                 </tr>
              </tbody>
              </table>
              <table class="rqst-tble rqst-tble1">
                    <thead>
                        <tr>
                            <th scope="col">Comment</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td data-label="Type" style=" padding-top: 0px !important;">Bangaluru Flyover</td>
                        </tr>
                    </tbody>
              </table>
                <!-- /.box -->
              </div>
            </div>
            <div class="col-xs-12">
          <div class="box custom-box">
            <div class="row">
              <div class="col-md-7">
                <div class="col-md-2">
                   <div class="row">
                     <div class="profile-img">
                           <img alt="User Image" src="http://woco.co.in/uploads/user/1554275199.png" class=" profile-logo-img img-responsive " style=" width: 82px !important;">
                       </div>
                   </div>
                </div>
                <div class="col-md-9">
                  <div class="twPc-divUser" style=" margin-left: 0px !important;">
                     <div class="twPc-divName profile-info">
                       <h2>Hr Manager</h2>
                       <div class="details">
                         <div class="i-btn">
                            <li class="twPc-ArrangeSizeFit">
                              <span><i class="fa fa-briefcase emp-icon"></i><a href="#">HR Manager  </a></span>
                             </li>
                          </div>
                       </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-md-5">
                <div class="box-footer" style="/* text-align:center; */float: right;/* margin-top: -35px; */">
                    <input type="submit" class="btn btn-primary" value="Approve" style="width:134px !important; height: 38px !important;" data-toggle="modal" data-target="#myModal">
                      <input type="reset" class="btn btn-default rqst-btn-rst" onclick="resetform()" value="Reject" style="width:134px !important;">
                  </div>
              </div>

            </div>
            <hr style=" margin-top: 6px !important; border-top: 2px solid #eceff5;">
            <table class="rqst-tble rqst-tble1" style="margin-top: -6px;">
                    <thead>
                        <tr>
                          <th scope="col">Leave Dates</th>
                          <th scope="col">Leave Type</th>
                          <th scope="col">Applied on</th>
                          <th scope="col">Category</th>
                          <th scope="col">Leave Status</th>
                        </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td data-label="Type">7 May- 11 May 2019</td>
                        <td data-label="Category">Full Day</td>
                        <td data-label="Category">29 Apr 2019</td>
                        <td data-label="Category">EL</td>
                        <td data-label="Category">Pending</td>
                       </tr>
                    </tbody>
              </table>
              <table class="rqst-tble rqst-tble1">
                    <thead>
                        <tr>
                            <th scope="col">Comment</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td data-label="Type" style=" padding-top: 0px !important;">Bangaluru Flyover</td>
                        </tr>
                    </tbody>
              </table>
                <!-- /.box -->
              </div>
            </div>
            <div class="col-xs-12">
          <div class="box custom-box">
            <div class="row">
              <div class="col-md-7">
                <div class="col-md-2">
                   <div class="row">
                     <div class="profile-img leaverequest-img">
                           <img alt="User Image" src="http://woco.co.in/uploads/user/1554275199.png" class=" profile-logo-img img-responsive " style=" width: 82px !important;">
                       </div>
                   </div>
                </div>
                <div class="col-md-9">
                  <div class="twPc-divUser" style=" margin-left: 0px !important;">
                     <div class="twPc-divName profile-info">
                       <h2>Hr Manager</h2>
                       <div class="details">
                         <div class="i-btn">
                            <li class="twPc-ArrangeSizeFit">
                              <span><i class="fa fa-briefcase emp-icon"></i><a href="#">HR Manager  </a></span>
                             </li>
                          </div>
                       </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-md-5">
                <div class="box-footer" style="/* text-align:center; */float: right;/* margin-top: -35px; */">
                    <input type="submit" class="btn btn-primary" value="Approve" style="width:134px !important; height: 38px !important;" data-toggle="modal" data-target="#myModal">
                      <input type="reset" class="btn btn-default rqst-btn-rst" onclick="resetform()" value="Reject" style="width:134px !important;">
                  </div>
              </div>

            </div>
            <hr style=" margin-top: 6px !important; border-top: 2px solid #eceff5;">
            <table class="rqst-tble rqst-tble1" style="margin-top: -6px;">
              <thead>
                  <tr>
                    <th scope="col">Leave Dates</th>
                    <th scope="col">Leave Type</th>
                    <th scope="col">Applied on</th>
                    <th scope="col">Category</th>
                    <th scope="col">Leave Status</th>
                  </tr>
              </thead>
              <tbody>
                <tr>
                  <td data-label="Type">7 May- 11 May 2019</td>
                  <td data-label="Category">Full Day</td>
                  <td data-label="Category">29 Apr 2019</td>
                  <td data-label="Category">EL</td>
                  <td data-label="Category">Pending</td>
                 </tr>
              </tbody>
              </table>
              <table class="rqst-tble rqst-tble1">
                    <thead>
                        <tr>
                            <th scope="col">Comment</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td data-label="Type" style=" padding-top: 0px !important;">Bangaluru Flyover</td>
                        </tr>
                    </tbody>
              </table>
                <!-- /.box -->
              </div>
            </div>
        </div>
    </section>





</div>

<!-- Modal -->
<div class="modal right fade" id="myModal2" role="dialog" aria-labelledby="myModalLabel2">
<div class="modal-dialog" role="document">
<div class="modal-content">

  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
    <h4 class="modal-title" id="myModalLabel2">Add New Team </h4>
  </div>

  <div class="modal-body">
      <h4>Enter Team Details</h4>
        <!-- form start -->
        <?php $this->load->helper("form"); ?>
        <form id="admin-form" role="form" action="<?php echo base_url() ?>hr/team/add" method="post" role="form" class="custom-form">
            <div class="box-body">
              <div class="row">
                  <div class="col-md-12">
                    <div class="form-group">
                      <label for="description">Department</label>
                            <select id="add-team-department" class="itemName form-control" style="width: 98%; height: 32px;" name="department" value="" required >
                                <option value="">-- Select Employee Department --</option>
                                <?php foreach ($department as $key => $value): ?>
                                  <option value="<?php echo $value->id; ?>"><?php echo $value->title; ?></option>
                                <?php endforeach; ?>
                            </select>
                         </div>
                      </div>
                  </div>
              </div>
              <div class="row">
                <div class="col-md-12">
                    <div class="form-group">
                      <label for="head">Head</label>

                      <select id="add-team-head" class="itemName form-control" style="width: 98%; height: 32px;" name="head" value="" required>
                          <option value="">-- Select Employee Head --</option>
                          <?php foreach ($head as $key => $value): ?>
                            <option value="<?php echo $value->id; ?>"><?php echo $value->name; ?></option>
                          <?php endforeach; ?>
                      </select>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-12">
                      <div class="form-group">
                        <label for="title">Title</label>
                        <input type="text" class="form-control required" value="<?php echo set_value('title'); ?>" id="title" name="title" maxlength="128" required>
                    </div>
                  </div>


                </div>
                <div class="row">
                    <div class="col-md-12">
                      <div class="form-group">
                        <label for="description">Description</label>
                        <textarea name="description" rows="4" cols="40" class="form-control required" value="<?php echo set_value('description'); ?>" id="description" maxlength="128" required></textarea>
                        </div>
                    </div>
                </div>
            </div><!-- /.box-body -->

            <div class="box-footer">
                <input type="submit" class="btn btn-primary" value="Submit" />
                <input type="reset" class="btn btn-default" value="Reset" />
            </div>
        </form>
  </div>

</div><!-- modal-content -->
</div><!-- modal-dialog -->
</div><!-- modal -->



<!-- Modal -->
<div class="modal right fade" id="myModal3" role="dialog" aria-labelledby="myModalLabel">
<div class="modal-dialog" role="document">
<div class="modal-content">

  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
    <h4 class="modal-title" id="myModalLabel2">Edit Team </h4>
  </div>

  <div class="modal-body">
      <h4>Edit Team Details</h4>
        <!-- form start -->
        <?php $this->load->helper("form"); ?>
        <form id="admin-edit-form" role="form" action="<?php echo base_url() ?>hr/team/edit" method="post" role="form" class="custom-form">
            <div class="box-body">
              <div class="row">
                  <div class="col-md-12">
                    <div class="form-group">
                      <label for="department">Department</label>

                          <select class="itemName form-control" style="width: 98%; height: 32px;"  id="edit_department"  name="department" value="" required >
                              <option value="">-- Select Employee Department --</option>
                              <?php foreach ($department as $key => $value): ?>
                                <option value="<?php echo $value->id; ?>"><?php echo $value->title; ?></option>
                              <?php endforeach; ?>
                          </select>

                         </div>
                      </div>
                  </div>
              <div class="row">
                <div class="col-md-12">
                    <div class="form-group">
                      <label for="head">Title</label>
                      <input type="text" class="form-control required" value="" id="edit_head" name="head" maxlength="128" required>
                  </div>
                </div>
              </div>

              <div class="row">
                <div class="col-md-12">
                    <div class="form-group">
                      <label for="title">Title</label>
                      <input type="text" class="form-control required" value="" id="edit_title" name="title" maxlength="128" required>
                  </div>
                </div>
              </div>
              <div class="row">
                  <div class="col-md-12">
                    <div class="form-group">
                      <label for="description">Description</label>
                      <textarea name="description" rows="4" cols="40" class="form-control required" value="" id="edit_description" maxlength="128" required></textarea>
                      </div>
                  </div>
              </div>
            </div><!-- /.box-body -->

            <div class="box-footer">
                <input type="submit" class="btn btn-primary" value="Submit" />
                <!-- <input type="reset" class="btn btn-default" value="Reset" /> -->
            </div>
        </form>
  </div>

</div><!-- modal-content -->
</div><!-- modal-dialog -->
</div><!-- modal -->
<div class="modal fade popup-form" id="myModal" role="dialog">
   <div class="modal-dialog">

     <!-- Modal content-->
     <div class="modal-content">
       <div class="">
         <button type="button" class="close" data-dismiss="modal"></button>
          <h4 class="modal-title" style="text-align: center; padding-top: 35px;">Approve Leave Request ?</h4>
       </div>
       <div class="modal-body">
         <textarea></textarea>
       </div>
       <div class="modal-footer">
         <input type="submit" class="btn btn-primary" value="Approve" style="width:134px !important; height: 38px !important;" data-toggle="modal" data-target="#myModal">
          <input type="reset"  data-dismiss="modal" class="btn btn-default rqst-btn-rst" onclick="resetform()" value="Cancel">

       </div>
     </div>

   </div>
 </div>
<script type="text/javascript" src="<?php echo base_url(); ?>assets/js/common.js" charset="utf-8"></script>

<script type="text/javascript" language="javascript" >
var dataTable;

    $('.search-input-text').on( 'keyup click change', function () {   // for text boxes
        var i =$(this).attr('data-column');  // getting column index
        var v =$(this).val();  // getting search input value
        dataTable.columns(i).search(v).draw();
    } );
    $('.search-input-select').on( 'change', function () {   // for select box
        var i =$(this).attr('data-column');
        var v =$(this).val();
        dataTable.columns(i).search(v).draw();
    } );

    $("#admin-form").submit(function(e) {
        var frm = $(this);
        e.preventDefault();
        $('#loader').show();
        $.ajax({
            type: frm.attr('method'),
            url: frm.attr('action'),
            data: frm.serialize(),
            dataType: 'JSON',
            success: function (data) {
              $('#loader').hide();
                if (data.status == 1) {
                  $("#admin-form").trigger("reset");
                  $('#myModal2').modal('hide');
                  dataTable.ajax.reload();
          				swal("Success", data.message, "success");
          			}else {
          				swal("Failed!", data.message, "error");
          			}
            },
            error: function (data) {
              $('#loader').hide();
                swal("Error", data.message, "error");
            },
        });
    });

    $("#admin-edit-form").submit(function(e) {
        var frm = $(this);
        e.preventDefault();
        $('#loader').show();
        $.ajax({
            type: frm.attr('method'),
            url: frm.attr('action'),
            data: frm.serialize(),
            dataType: 'JSON',
            success: function (data) {
              $('#loader').hide();
                if (data.status == 1) {
                  $("#admin-edit-form").trigger("reset");
                  $('#myModal3').modal('hide');
                  dataTable.ajax.reload();
          				swal("Success", data.message, "success");
          			}else {
          				swal("Failed!", data.message, "error");
          			}
            },
            error: function (data) {
              $('#loader').hide();
                swal("Error", data.message, "error");
            },
        });
    });
</script>


<script>
  $(document).ready(function () {
    dataTable = $('#example').DataTable({
        "order": [[ 0, "desc" ]],
        "iDisplayLength": 10,
        "processing": true,
        "language": {
            "processing": '<img src="<?php echo base_url(); ?>assets/website/loading.gif" />' //add a loading image,simply putting <img src="loader.gif" /> tag.
        },
        "serverSide": true,
        "ajax":{
          "url": "<?php echo base_url("hr/team/getListData"); ?>",
          "dataType": "json",
          "type": "POST",
          "data":{ 'ci_csrf_token' : '' }
        },
        "columns": [
          { "data": "id" },
          { "data": "title" },
          { "data": "department" },
          { "data": "head" },
          { "data": "description" },
          { "data": "created" },
          { "data": "created_by" },
          { "data": "action" }
        ],
        "columnDefs": [
          {
            "targets": 0,
            "render": function ( data, type, row )
            {
              return data;
            }
          },

          {
            "targets": 1,
            "render": function ( data, type, row ) {
              return data;
            }
          },

          {
            "targets": 2,
            "render": function ( data, type, row ) {
              return data;
            }
          },

          {
            "targets": 3,
            "render": function ( data, type, row ) {
              return data;
            }
          },
          {
            "targets": 4,
            "render": function ( data, type, row ) {
              if (data.length > 20) {
                return data.substring(0,20)+".....";
              }else {
                return data;
              }
            }
          },
          {
            "targets": 5,
            "render": function ( data, type, row ) {
               var todayTime = new Date(data);
               var month = todayTime .getMonth() + 1
               var day   = todayTime .getDate();
               var year = todayTime .getFullYear();
               return (day<10?`0${day}`:day) + "/" + (month<10?`0${month}`:month) + "/" + year;
            }
          },
          {
            "targets": 6,
            "render": function ( data, type, row ) {
            return data;
            }
          },
          {
            "targets": 7,
            orderable: false,
            "render": function ( data, type, row ) {
              var str = "<div style='width:120px'>";
              str += '<a class="btn btn-sm " href="javascript:editTeam(' + row.id + ')" title="Edit"><i class="fa fa-pencil"></i></a>';
              str += '<a class="btn btn-sm " href="javascript:deleteTeam(' + row.id + ')" title="Delete"><i class="fa fa-trash"></i></a>';
              str += '</div>';
              return str;
            }
          }
        ]
  });

});

    function blockTeam(id) {
      swal({
        title: "Are you sure?",
        text: "Team will be blocked.",
        icon: "warning",
        buttons: true,
        dangerMode: true,
      })
      .then((willDelete) => {
        if (willDelete) {
          $('#loader').show();
          $.ajax({
              type: 'GET',
              url: '<?php echo base_url().'hr/team/block/'; ?>'+id,
              dataType: 'JSON',
              success: function (data) {
                $('#loader').hide();
                  if (data.status == true) {
                    swal(data.message, {
                      icon: "success",
                    }).then((value) => {
                      dataTable.ajax.reload();
                      });
                  }
                  else {
                    swal("Failed!", data.message, "error");
                  }
              },
              error: function (data) {
                $('#loader').hide();
                  swal("Error", 'An error occurred.', "error");
              },
          });

        } else {
          swal("Process cancelled");
        }
      });
    }


    function unblockTeam(id) {
          swal({
        title: "Are you sure?",
        text: "Team will be unblocked.",
        icon: "warning",
        buttons: true,
        dangerMode: true,
      })
      .then((willDelete) => {
        if (willDelete) {
          $('#loader').show();
          $.ajax({
                  type: 'GET',
                  url: '<?php echo base_url().'hr/team/unblock/'; ?>'+id,
                  dataType: 'JSON',
                  success: function (data) {
                    $('#loader').hide();
                      if (data.status == true) {
                        swal(data.message, {
                          icon: "success",
                        }).then((value) => {
                          dataTable.ajax.reload();
                          });
                      }
                      else {
                        swal("Failed!", data.message, "error");
                      }
                  },
                  error: function (data) {
                    $('#loader').hide();
                      swal("Error", 'An error occurred.', "error");
                  },
              });

        } else {
          swal("Process cancelled");
        }
      });
    }


    function editTeam(id) {
        $('#loader').show();
        $.ajax({
                type: 'GET',
                url: '<?php echo base_url().'hr/team/edit/'; ?>'+id,
                dataType: 'JSON',
                success: function (data) {
                  $('#loader').hide();
                    if (data.status == 1) {

                      var hrData = data.data[0];
                      $('#admin-edit-form').attr('action','<?php echo base_url().'hr/team/edit/'; ?>'+id);
                      $('#edit_title').val(hrData.title);
                      $('#edit_department option[value='+hrData.department_id+']').attr('selected','selected');

                      $('#edit_description').val(hrData.description);
                      $('#myModal3').modal('toggle');

                    }else {
                      swal("Failed!", data.message, "error");
                    }
                },
                error: function (data) {
                  $('#loader').hide();
                    swal("Error", 'An error occurred.', "error");
                },
            });
    }


    function deleteTeam(id) {
        swal({
            title: "Are you sure?",
            text: "Data will be deleted.",
            icon: "warning",
            buttons: true,
            dangerMode: true,
          })
          .then((willDelete) => {
            if (willDelete) {
              $('#loader').show();
              $.ajax({
                      type: 'GET',
                      url: '<?php echo base_url().'hr/team/delete/'; ?>'+id,
                      dataType: 'JSON',
                      success: function (data) {
                        $('#loader').hide();
                          if (data.status == true) {
                            swal(data.message, {
                              icon: "success",
                            }).then((value) => {
                              dataTable.ajax.reload();
                              });
                          }
                          else {
                            swal("Failed!", data.message, "error");
                          }
                      },
                      error: function (data) {
                        $('#loader').hide();
                          swal("Error", 'An error occurred.', "error");
                      },
                  });

            } else {
              swal("Process cancelled");
            }
          });
    }

    $('#add-team-department').on('change', function() {
        $('#add-team-head').html('');

  $.ajax({
          type: 'GET',
          url: '<?php echo base_url().'hr/team/getusers/'; ?>'+this.value,
          dataType: 'JSON',
          success: function (data) {
            $('#loader').hide();
              if (data.status == true) {
                var str = "";
                for (var i = 0; i < data.data.length; i++) {
                  var row = data.data[i];
                  str += '<option value="'+row.userId+'">'+row.name+'('+row.email+')</option>';
                }
                $('#add-team-head').html(str);
              }
              else {
                swal("Failed!", data.message, "error");
                  $('#add-team-head').html('');
              }
          },
          error: function (data) {
            $('#loader').hide();
              swal("Error", 'An error occurred.', "error");
                $('#add-team-head').html('');
          },
      });
});


</script>
